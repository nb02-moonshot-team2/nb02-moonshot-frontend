# Moonshot 프론트엔드

## 준비

필요한 패키지를 설치해 주세요. 

```bash
npm install
```

## 프로젝트 설정

### API Base URL 환경변수 설정
`.env` 파일 생성 후 `.env.sample` 파일을 참고하여 환경변수를 설정합니다.
예를들어서 로컬 백엔드 서버의 주소가 `http://localhost:3001`이라면 다음과 같이 설정합니다.

```
NEXT_PUBLIC_API_URL=http://localhost:3001
```

이 환경 변수는 Next.js 서버에서 Base URL로 쓰도록 구현해 둔 값입니다. `/shared/axios.ts` 파일에서 Axios 인스턴스 생성에 사용합니다.

## 프로젝트 로컬에서 실행

Next.js 프로젝트를 로컬에서 실행합니다.

```bash
npm run dev
```

## API 수정 및 디버깅 하기

`/lib/api.ts` 파일을 수정하여 백엔드 API 리퀘스트를 디버깅하실 수 있습니다.

Next.js의 경우 프론트엔드 개발 프레임워크이지만 BFF(Backend For Frontend) 서버이기 때문에,
Client -> Next.js 서버 -> 백엔드 서버 순으로 리퀘스트가 흐릅니다. (리스폰스는 반대)
이때 클라이언트가 Next.js 서버에 보내는 리퀘스트는 백엔드 서버의 API 명세와 무관합니다.

따라서 기본적으로 Next.js 서버에서 백엔드로 보내는 리퀘스트가 웹 브라우저에서 노출되지 않으며, 마찬가지로 백엔드에서 주는 리스폰스도 그대로 웹 브라우저에 노출되지 않습니다.

그래서 수강생 편의를 위해 의도적으로 `api.ts` 파일에 모든 리퀘스트에 대한 함수를 분리해 두었습니다.
여기서 `logError()` 함수를 통해 에러가 발생했을 때 백엔드 서버에서 주는 리스폰스를 콘솔에 출력할 수 있습니다.
또한 엔드포인트 경로를 수정하거나, 원하는 쿼리 파라미터 혹은 바디 타입을 사용하도록 수정하시면 됩니다.


## (참고) 인증 관련 구현
이 프로젝트는 인증을 할 때 다음과 같이 진행되도록 구현되어 있습니다.

### 로그인
사용자가 웹 브라우저에서 이메일과 비밀번호로 인증 요청을 하면,
웹 브라우저는 Next.js 서버에 리퀘스트를 보냅니다.
Next.js 서버는 받은 리퀘스트를 토대로 백엔드에 인증 리퀘스트르 보내고, 리스폰스 바디로 토큰을 전달 받습니다.
Next.js 서버가 토큰을 받으면, 이것을 `Set-Cookie` 헤더를 활용해 Next.js 서버 기준으로 쿠키를 발급하도록 구현했습니다.
웹 브라우저는 Next.js 서버에게서 쿠키를 받아서 토큰을 저장합니다.

### 인증이 필요한 리퀘스트의 경우
웹 브라우저는 토큰을 쿠키로 저장하고 있습니다.
웹 브라우저는 Next.js 서버에 리퀘스트를 보냅니다. 이때 쿠키도 `Cookie` 헤더로 함께 전달됩니다.
Next.js 서버는 리퀘스트에서 `Cookie` 헤더를 확인해 액세스 토큰이 있는지 확인합니다.
액세스 토큰이 있다면, Next.js 서버는 `Authorization: Bearer <access token>` 헤더를 설정해 백엔드로 리퀘스트를 보냅니다.
서버에서 인증을 확인하고 적절한 리스폰스를 보내줍니다.

### 액세스 토큰이 만료된 경우
인증이 필요한 요청을 했을 때 401 상태 코드가 오면 axios 인터셉터에서 토큰 갱신을 하도록 구현되어 있습니다.(`shared/axios.ts`)
만약 갱신에 성공하면 Next.js 서버는 백엔드 서버에서 리스폰스 바디로 받은 토큰을 쿠키로 세팅해 웹 브라우저로 보내줍니다.

> 참고로 인증을 구현할 수 있는 방식은 여러가지가 있을 수 있으니, 이 방식은 하나의 방식으로 참고만 해 주세요.


### (참고) 이미지 주소 허용

Next.js 프론트엔드에서는 이미지 파일을 사용할 때 `next.config.js` 파일에서 이미지 주소를 허용해 주어야 합니다.
만약 백엔드 서버에 업로드한 이미지 파일이 `http://localhost:3001/.../photo.png`와 같이 제공된다면 Next.js에서 이미지를 올바로 보여주기 위해 해당 주소를 허용해 주어야 합니다. (`remotePatterns` 부분)

현재 코드는 개발 편의를 위해 모든 호스트를 허용하도록 설정되어 있습니다.

```js
module.exports = {
  ...
  images: {
    remotePatterns: [
      {
        hostname: '**',
      },
    ],
  },
}
```